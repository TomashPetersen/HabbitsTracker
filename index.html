<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Трекер привычек</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%238b5cf6'/%3E%3Cpath d='M9 16l5 5 9-9' stroke='%23ffffff' stroke-width='3' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel Standalone for in-browser JSX/TSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background-color: #111827; /* bg-gray-900 */
        color: #e5e7eb; /* text-gray-200 */
      }
      .loader {
        text-align: center;
        padding: 4rem;
        font-size: 1.5rem;
        color: #9ca3af; /* text-gray-400 */
      }
    </style>
</head>
<body>
    <div id="root">
        <div class="loader">Загрузка приложения...</div>
    </div>

    <script type="text/babel">
// De-structure React hooks and components for ease of use
const {
    createContext,
    useReducer,
    useEffect,
    useCallback,
    useContext,
    useState,
    useRef,
    useMemo,
    Fragment
} = React;

// --- From constants.ts ---
const MONTH_NAMES = [
  "Январь", "Февраль", "Март", "Апрель", "Май", "Июнь",
  "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"
];
const DAY_NAMES_SHORT = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"];
const HABIT_COLORS = [
  '#f87171', '#fb923c', '#facc15', '#4ade80',
  '#38bdf8', '#818cf8', '#c084fc', '#f472b6'
];

// --- From utils/calendar.ts ---
const getDaysInMonth = (year, month) => {
  return new Date(year, month + 1, 0).getDate();
};
const getFirstDayOfMonth = (year, month) => {
  const day = new Date(year, month, 1).getDay();
  return day === 0 ? 6 : day - 1;
};

// --- From utils/stats.ts ---
const calculateStreaks = (habit, totalDays) => {
    let maxStreak = 0;
    let currentStreak = 0;

    for (let day = 1; day <= totalDays; day++) {
        if (habit.days[day]) {
            currentStreak++;
        } else {
            if (currentStreak > maxStreak) {
                maxStreak = currentStreak;
            }
            currentStreak = 0;
        }
    }

    // Final check for a streak that goes to the end of the month
    if (currentStreak > maxStreak) {
        maxStreak = currentStreak;
    }

    return { maxStreak };
};

const calculateCompletion = (habit, totalDays) => {
    const completedDays = Object.values(habit.days).filter(Boolean).length;
    if (totalDays === 0) return { percentage: 0, count: 0 };
    const percentage = Math.round((completedDays / totalDays) * 100);
    return { percentage, count: completedDays };
};

// --- From hooks/useDebounce.ts ---
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);
  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);
    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);
  return debouncedValue;
}

// --- From services/storageService.ts ---
const STORAGE_KEY = 'monthhabit_v1';
const BACKUP_KEY = 'monthhabit_backup';
const saveState = (state) => {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  } catch (error) {
    console.error("Не удалось сохранить состояние:", error);
  }
};
const loadState = () => {
  try {
    const serializedState = localStorage.getItem(STORAGE_KEY);
    return serializedState ? JSON.parse(serializedState) : undefined;
  } catch (error) {
    console.error("Не удалось загрузить состояние:", error);
    return undefined;
  }
};
const exportData = (state) => {
  try {
    const dataStr = JSON.stringify(state, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    const exportFileDefaultName = `monthhabit_backup_${new Date().toISOString().slice(0, 10)}.json`;
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
  } catch (error) {
    console.error("Ошибка экспорта:", error);
  }
};
const importData = (file, callback) => {
  const reader = new FileReader();
  reader.onload = (event) => {
    try {
      const result = event.target?.result;
      if (typeof result === 'string') {
        const newState = JSON.parse(result);
        if (newState.version && newState.years) {
          const currentState = loadState();
          if (currentState) {
            localStorage.setItem(BACKUP_KEY, JSON.stringify(currentState));
          }
          callback(newState);
          alert("Данные успешно импортированы!");
        } else {
          throw new Error("Неверный формат файла.");
        }
      }
    } catch (error) {
      console.error("Ошибка импорта:", error);
      alert(`Не удалось импортировать данные. Ошибка: ${error.message}`);
    }
  };
  reader.readAsText(file);
};

// --- From context/AppContext.tsx ---
const AppContext = createContext(undefined);
const AppProvider = ({ children }) => {
  const initialState = { version: '1', years: {} };
  
  const appReducer = (state, action) => {
    // Deep copy state to avoid mutation issues
    const newState = JSON.parse(JSON.stringify(state));
    switch (action.type) {
      case 'SET_STATE': return action.payload;
      case 'ADD_HABIT': {
        const { year, month, title } = action.payload;
        const monthKey = `${year}-${month}`;
        if (!newState.years[year]) newState.years[year] = {};
        if (!newState.years[year][monthKey]) newState.years[year][monthKey] = { habits: [] };
        const existingHabits = newState.years[year][monthKey].habits;
        const nextColorIndex = existingHabits.length % HABIT_COLORS.length;
        const newHabit = {
          id: `h-${Date.now()}`, title, days: {}, color: HABIT_COLORS[nextColorIndex],
        };
        newState.years[year][monthKey].habits.push(newHabit);
        return newState;
      }
      case 'UPDATE_HABIT_TITLE': {
        const { year, month, habitId, newTitle } = action.payload;
        const monthKey = `${year}-${month}`;
        const habit = newState.years[year]?.[monthKey]?.habits.find(h => h.id === habitId);
        if (habit) habit.title = newTitle;
        return newState;
      }
      case 'DELETE_HABIT': {
        const { year, month, habitId } = action.payload;
        const monthKey = `${year}-${month}`;
        if (newState.years[year]?.[monthKey]) {
          newState.years[year][monthKey].habits = newState.years[year][monthKey].habits.filter(h => h.id !== habitId);
        }
        return newState;
      }
      case 'TOGGLE_DAY': {
        const { year, month, habitId, day } = action.payload;
        const monthKey = `${year}-${month}`;
        const habit = newState.years[year]?.[monthKey]?.habits.find(h => h.id === habitId);
        if (habit) habit.days[day] = !habit.days[day];
        return newState;
      }
      case 'RESET_HABIT_PROGRESS': {
        const { year, month, habitId } = action.payload;
        const monthKey = `${year}-${month}`;
        const habit = newState.years[year]?.[monthKey]?.habits.find(h => h.id === habitId);
        if (habit) {
          habit.days = {};
        }
        return newState;
      }
      case 'CLEAR_HISTORY': return initialState;
      default: return state;
    }
  };

  const initialDateState = { year: new Date().getFullYear(), month: new Date().getMonth() };
  const dateReducer = (state, action) => {
    return action.type === 'CHANGE_DATE' ? action.payload : state;
  };

  const [appState, appDispatch] = useReducer(appReducer, loadState() || initialState);
  const [currentDate, dateDispatch] = useReducer(dateReducer, initialDateState);
  const debouncedState = useDebounce(appState, 500);

  useEffect(() => { saveState(debouncedState); }, [debouncedState]);

  const dispatch = useCallback((action) => {
    action.type === 'CHANGE_DATE' ? dateDispatch(action) : appDispatch(action);
  }, []);

  const value = { state: { ...appState, currentDate }, dispatch };
  return <AppContext.Provider value={value}>{children}</AppContext.Provider>;
};

// --- From components/ConfirmationModal.tsx ---
const ConfirmationModal = ({ isOpen, onClose, onConfirm, title, message }) => {
  if (!isOpen) return null;
  return (
    <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick={onClose}>
      <div className="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm" onClick={e => e.stopPropagation()}>
        <h2 className="text-xl font-bold text-white">{title}</h2>
        <p className="mt-2 text-gray-400">{message}</p>
        <div className="mt-6 flex justify-end gap-4">
          <button onClick={onClose} className="px-4 py-2 rounded-md text-sm font-medium bg-gray-600 hover:bg-gray-500 transition-colors">Отмена</button>
          <button onClick={onConfirm} className="px-4 py-2 rounded-md text-sm font-medium bg-red-600 hover:bg-red-500 text-white transition-colors">Подтвердить</button>
        </div>
      </div>
    </div>
  );
};

// --- From components/Statistics.tsx ---
const Statistics = ({ habit, daysInMonth }) => {
  const { completion, streaks } = useMemo(() => ({
    completion: calculateCompletion(habit, daysInMonth),
    streaks: calculateStreaks(habit, daysInMonth),
  }), [habit, daysInMonth]);

  return (
    <div className="flex flex-col text-center text-sm font-mono text-gray-400">
      <div title="Процент выполнения / выполнено дней">{completion.percentage}% ({completion.count})</div>
      <div title="Рекорд привычек подряд!" className="flex items-center justify-center gap-1 mt-1">
          <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 text-violet-400" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" clipRule="evenodd" /></svg>
          {streaks.maxStreak}
      </div>
    </div>
  );
};


// --- From components/HabitRow.tsx ---
const HabitRow = ({ habit, year, month, daysInMonth, isReadOnly }) => {
  const context = useContext(AppContext);
  const [isEditing, setIsEditing] = useState(false);
  const [title, setTitle] = useState(habit.title);
  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
  const [isResetModalOpen, setIsResetModalOpen] = useState(false);
  const debouncedTitle = useDebounce(title, 500);

  useEffect(() => {
    if (debouncedTitle !== habit.title) {
      context?.dispatch({ type: 'UPDATE_HABIT_TITLE', payload: { year, month, habitId: habit.id, newTitle: debouncedTitle } });
    }
  }, [debouncedTitle, habit.title, context, year, month, habit.id]);
  
  useEffect(() => {
    setTitle(habit.title);
  }, [habit.title]);

  if (!context) return null;
  const { dispatch } = context;

  const handleToggleDay = (day) => {
    if (!isReadOnly) dispatch({ type: 'TOGGLE_DAY', payload: { year, month, habitId: habit.id, day } });
  };
  const handleDelete = () => {
    dispatch({ type: 'DELETE_HABIT', payload: { year, month, habitId: habit.id } });
    setIsDeleteModalOpen(false);
  };
  const handleResetProgress = () => {
    dispatch({ type: 'RESET_HABIT_PROGRESS', payload: { year, month, habitId: habit.id } });
    setIsResetModalOpen(false);
  };
  const handleTitleBlur = () => {
    setIsEditing(false);
    if (title.trim() === '') setTitle(habit.title);
  };
  
  const today = new Date();
  const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

  return (
    <Fragment>
      <div className="sticky left-0 bg-gray-800 z-10 flex items-center gap-2 p-2 border-t border-gray-700">
         <button 
            onClick={() => setIsResetModalOpen(true)} 
            disabled={isReadOnly} 
            className="flex-shrink-0 text-gray-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed text-sm px-2 py-1 rounded hover:bg-gray-700 transition-colors"
            title="Сбросить прогресс за месяц">
            Сбросить
        </button>
        <div className="w-1 h-full flex-shrink-0 rounded-full" style={{ backgroundColor: habit.color }}></div>
         <div className="flex-grow min-w-0">
            {isEditing ? (
              <input
                type="text" value={title} onChange={(e) => setTitle(e.target.value)}
                onBlur={handleTitleBlur} onKeyDown={(e) => e.key === 'Enter' && e.target.blur()}
                className="w-full bg-gray-700 text-white p-1 rounded-md" autoFocus
              />
            ) : (
              <span onDoubleClick={() => !isReadOnly && setIsEditing(true)} className="break-words cursor-pointer">{habit.title}</span>
            )}
        </div>
        <button onClick={() => setIsDeleteModalOpen(true)} disabled={isReadOnly} className="ml-auto flex-shrink-0 text-gray-500 hover:text-red-500 disabled:opacity-30 disabled:hover:text-gray-500 p-2 rounded-full hover:bg-gray-700 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" /></svg>
        </button>
      </div>
      {Array.from({ length: daysInMonth }, (_, i) => i + 1).map(day => {
        const isChecked = !!habit.days[day];
        const isPrevChecked = day > 1 && !!habit.days[day - 1];
        const isNextChecked = day < daysInMonth && !!habit.days[day + 1];

        const streakCellClasses = isChecked && (isPrevChecked || isNextChecked) ? 'py-1 px-0' : 'p-1';
        
        let streakCheckboxClasses = 'rounded-sm';
        if (isChecked) {
            if (isPrevChecked && isNextChecked) {
                streakCheckboxClasses = 'rounded-none';
            } else if (isPrevChecked) {
                streakCheckboxClasses = 'rounded-r-sm rounded-l-none';
            } else if (isNextChecked) {
                streakCheckboxClasses = 'rounded-l-sm rounded-r-none';
            }
        }
        
        return (
            <div key={day} className={`flex items-center justify-center border-t border-gray-700 ${isCurrentMonth && day === today.getDate() ? 'bg-gray-700/50' : ''} ${streakCellClasses}`}>
              <input type="checkbox" checked={isChecked} onChange={() => handleToggleDay(day)} disabled={isReadOnly}
                className={`w-full h-full appearance-none border-2 border-gray-600 transition-colors cursor-pointer disabled:cursor-not-allowed disabled:opacity-50 checked:border-transparent ${streakCheckboxClasses}`}
                style={isChecked ? { backgroundColor: habit.color } : {}}
              />
            </div>
        );
      })}
      <div className="flex items-center justify-center p-2 border-t border-gray-700">
        <Statistics habit={habit} daysInMonth={daysInMonth} />
      </div>
      <ConfirmationModal
        isOpen={isDeleteModalOpen} onClose={() => setIsDeleteModalOpen(false)} onConfirm={handleDelete}
        title="Удалить привычку?" message={`Вы уверены, что хотите удалить привычку "${habit.title}"? Это действие необратимо.`}
      />
      <ConfirmationModal
        isOpen={isResetModalOpen} onClose={() => setIsResetModalOpen(false)} onConfirm={handleResetProgress}
        title="Сбросить прогресс?" message={`Вы уверены, что хотите сбросить все отметки для привычки "${habit.title}" в этом месяце?`}
      />
    </Fragment>
  );
};

// --- From components/MonthView.tsx ---
const MonthView = () => {
  const context = useContext(AppContext);
  if (!context) return null;
  const { state } = context;
  const { year, month } = state.currentDate;
  const monthKey = `${year}-${month}`;
  
  const habits = state.years[year]?.[monthKey]?.habits || [];
  const daysInMonth = getDaysInMonth(year, month);
  const firstDayOfMonth = getFirstDayOfMonth(year, month);
  
  const today = new Date();
  const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
  
  const firstDayOfCurrentMonth = new Date(today.getFullYear(), today.getMonth(), 1);
  const firstDayOfSelectedMonth = new Date(year, month, 1);
  const isReadOnly = firstDayOfSelectedMonth < firstDayOfCurrentMonth;

  return (
    <div className="overflow-x-auto">
      {isReadOnly && (
        <div className="text-center p-2 mb-4 bg-violet-900/50 text-violet-300 rounded-md border border-violet-700">
          Это прошлый месяц (только просмотр).
        </div>
      )}
      {habits.length > 0 ? (
        <div className="grid gap-x-1" style={{ gridTemplateColumns: `minmax(350px, 3fr) repeat(${daysInMonth}, minmax(36px, 1fr)) minmax(100px, auto)`}}>
          <div className="sticky left-0 bg-gray-800 z-10 font-semibold text-gray-400 text-sm text-left p-2">Привычка</div>
          {Array.from({ length: daysInMonth }, (_, i) => i + 1).map(day => (
            <div key={day} className={`text-center font-mono text-sm p-2 rounded-md ${isCurrentMonth && day === today.getDate() ? 'bg-violet-700 text-white' : 'text-gray-400'}`}>
                <span className="hidden sm:inline">{DAY_NAMES_SHORT[(firstDayOfMonth + day - 1) % 7]}</span>
                <span className="sm:hidden">{day}</span>
                <span className="hidden sm:block">{day}</span>
            </div>
          ))}
          <div className="font-semibold text-gray-400 text-sm text-center p-2">Статистика</div>
          {habits.map(habit => (
            <HabitRow key={habit.id} habit={habit} year={year} month={month}
              daysInMonth={daysInMonth} isReadOnly={isReadOnly} />
          ))}
        </div>
      ) : (
        <div className="text-center py-12 text-gray-500">
          <p>Привычек на этот месяц еще нет.</p>
          <p>Добавьте первую, чтобы начать!</p>
        </div>
      )}
    </div>
  );
};


// --- From components/AddHabitForm.tsx ---
const AddHabitForm = () => {
  const [title, setTitle] = useState('');
  const context = useContext(AppContext);
  if (!context) return null;
  const { state, dispatch } = context;
  const { year, month } = state.currentDate;
  
  const today = new Date();
  const firstDayOfCurrentMonth = new Date(today.getFullYear(), today.getMonth(), 1);
  const firstDayOfSelectedMonth = new Date(year, month, 1);
  const isReadOnly = firstDayOfSelectedMonth < firstDayOfCurrentMonth;

  const handleSubmit = (e) => {
    e.preventDefault();
    if (title.trim()) {
      dispatch({ type: 'ADD_HABIT', payload: { year, month, title: title.trim() } });
      setTitle('');
    }
  };

  if (isReadOnly) return null;
  return (
    <form onSubmit={handleSubmit} className="mt-8 flex gap-2">
      <input type="text" value={title} onChange={(e) => setTitle(e.target.value)}
        placeholder="Новая привычка (напр. Читать 15 минут)"
        className="flex-grow bg-gray-700 border border-gray-600 text-gray-200 rounded-md px-4 py-2 focus:ring-2 focus:ring-violet-500 focus:outline-none" />
      <button type="submit" disabled={!title.trim()}
        className="bg-violet-600 hover:bg-violet-500 text-white font-semibold px-4 py-2 rounded-md transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed">
        Добавить
      </button>
    </form>
  );
};

// --- From components/Header.tsx ---
const Header = () => {
  const context = useContext(AppContext);
  const fileInputRef = useRef(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  if (!context) return null;
  const { state, dispatch } = context;
  const { year, month } = state.currentDate;

  const handleDateChange = (monthOffset) => {
    const newDate = new Date(year, month + monthOffset);
    dispatch({ type: 'CHANGE_DATE', payload: { year: newDate.getFullYear(), month: newDate.getMonth() } });
  };
  const handleExport = () => exportData(state);
  const handleImportClick = () => fileInputRef.current?.click();
  const handleFileChange = (event) => {
    const file = event.target.files?.[0];
    if (file && window.confirm("Вы уверены? Текущие данные будут заменены (но сохранятся в резервной копии).")) {
      importData(file, (newState) => dispatch({ type: 'SET_STATE', payload: newState }));
    }
  };
  const handleClearHistory = () => {
    dispatch({ type: 'CLEAR_HISTORY' });
    setIsModalOpen(false);
  };

  return (
    <Fragment>
      <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
        <div className="flex items-center gap-2">
          <button onClick={() => handleDateChange(-1)} className="p-2 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg></button>
          <span className="text-xl font-semibold w-40 text-center">{MONTH_NAMES[month]} {year}</span>
          <button onClick={() => handleDateChange(1)} className="p-2 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" /></svg></button>
        </div>
        <div className="flex items-center gap-2">
          <div className="relative group">
            <button className="p-2 rounded-md bg-gray-700 hover:bg-gray-600 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" /></svg></button>
            <div className="absolute right-0 mt-2 w-48 bg-gray-700 rounded-md shadow-lg z-10 hidden group-hover:block">
              <a href="#" onClick={handleExport} className="block px-4 py-2 text-sm text-gray-200 hover:bg-gray-600 rounded-t-md">Экспорт JSON</a>
              <a href="#" onClick={handleImportClick} className="block px-4 py-2 text-sm text-gray-200 hover:bg-gray-600">Импорт JSON</a>
              <a href="#" onClick={() => setIsModalOpen(true)} className="block px-4 py-2 text-sm text-red-400 hover:bg-red-500 hover:text-white rounded-b-md">Очистить историю</a>
              <input type="file" ref={fileInputRef} onChange={handleFileChange} accept=".json" className="hidden" />
            </div>
          </div>
        </div>
      </div>
      <ConfirmationModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} onConfirm={handleClearHistory}
        title="Подтвердите действие" message="Вы уверены, что хотите полностью очистить всю историю? Это действие необратимо."
      />
    </Fragment>
  );
};

// --- From App.tsx ---
const App = () => {
  const context = useContext(AppContext);
  if (!context) return <div className="loader">Инициализация контекста...</div>;
  return (
    <div className="min-h-screen font-sans">
      <main className="container mx-auto p-4 md:p-8">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-8">
            <h1 className="text-4xl md:text-5xl font-bold text-violet-400">Трекер привычек</h1>
            <p className="text-gray-400 mt-2">Отслеживайте свои привычки. Месяц за месяцем.</p>
          </div>
          <div className="bg-gray-800 rounded-xl shadow-2xl p-4 sm:p-6">
            <Header />
            <div className="mt-6">
              <MonthView />
              <AddHabitForm />
            </div>
          </div>
        </div>
        <footer className="text-center mt-12 text-gray-500 text-sm">
          <p>Создано Ульяной</p>
        </footer>
      </main>
    </div>
  );
};

// --- From index.tsx (entry point) ---
const rootElement = document.getElementById('root');
if (rootElement) {
    const root = ReactDOM.createRoot(rootElement);
    root.render(
      <React.StrictMode>
        <AppProvider>
          <App />
        </AppProvider>
      </React.StrictMode>
    );
} else {
    console.error("Root element not found");
}

    </script>
</body>
</html>